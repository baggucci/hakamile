<%# カードで囲い、見栄えを整える %>
<div class="card">
  <div class="card-body">
    <%= form_with model: post, local: true do |f| %>
      <%# --- エラーメッセージ表示エリア --- %>
      <% if post.errors.any? %>
        <div class="alert alert-danger">
          <h5 class="alert-heading"><%= post.errors.count %>件のエラー</h5>
          <ul>
            <% post.errors.full_messages.each do |message| %>
              <li><%= message %></li>
            <% end %>
          </ul>
        </div>
      <% end %>

      <%# --- フォーム項目 --- %>
      <div class="mb-3">
        <%= f.label :grave_id, "墓所", class: "form-label" %>
        <%= f.collection_select :grave_id, Grave.all, :id, :name, { prompt: "選択してください" }, class: "form-select" %>
      </div>

      <div class="mb-3">
        <%= f.label :title, "タイトル", class: "form-label" %>
        <%= f.text_field :title, class: "form-control" %>
      </div>

      <div class="mb-3">
        <%= f.label :body, "本文", class: "form-label" %>
        <%= f.text_area :body, rows: 8, class: "form-control" %>
      </div>
      
      <div class="mb-3">
        <%= f.label :status, "公開ステータス", class: "form-label" %>
        <%# `form-select` クラスに変更 %>
        <%= f.select :status, Post.statuses.keys.map { |k| [t("enums.post.status.#{k}"), k] }, {}, class: "form-select" %>
      </div>

      <%# --- 画像管理エリア --- %>
      <div class="mb-3">
        <%= f.label :images, '画像', class: "form-label" %>
      
        <%# --- 既存の画像プレビューと削除チェックボックス --- %>
        <% if post.images.attached? %>
          <div class="mb-2">
            <p class="form-text">現在の画像（削除したい画像にチェックを入れてください）</p>
            <div class="current-images-container">
              <% post.images.each do |image| %>
                <div class="d-flex align-items-center mb-2">
                  <%= image_tag image.variant(resize_to_limit: [100, 100]), class: 'img-thumbnail me-3' %>
                  <div class="form-check">
                    <%# `check_box_tag` を使用し、パラメータ名を `delete_image_ids[]` にする %>
                    <%= check_box_tag "delete_image_ids[]", image.id, false, class: 'form-check-input' %>
                    <%= label_tag "delete_image_ids_#{image.id}", "削除", class: 'form-check-label' %>
                  </div>
                </div>
              <% end %>
            </div>
          </div>
        <% end %>
        
        <%# --- 新しい画像を追加するフォーム --- %>
        <div>
          <p class="form-text">新しく画像を追加する場合は、こちらから選択してください。</p>
          <%= f.file_field :images, multiple: true, class: "form-control" %>
        </div>
      </div>
      
      <div class="d-grid gap-2">
        <%= f.submit "投稿する", class: "btn btn-primary" %>
      </div>
      
    <% end %>
  </div>
</div>