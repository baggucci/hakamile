<div class="card border-0 shadow card-hover gold-left-border">
  <div class="container mt-5">
    <div class="row">

      <div class="col-md-4">
        <div class="mypage-profile-section">
          <%# --- 表示しているのが自分のページか、他人のページかでタイトルを切り替え --- %>
          <% if user_signed_in? && current_user == @user %>
            <h3 class="font-serif fw-bold text-primary-custom mb-4 display-6">
              <i class="fas fa-user-circle me-2 text-gold"></i>マイページ
            </h3>
          <% else %>
            <h3 class="font-serif fw-bold text-primary-custom mb-4 display-6">
              <i class="fas fa-user me-2 text-gold"></i>プロフィール
            </h3>
          <% end %>

          <div class="profile-card card border-0 shadow-lg">
            <div class="card-body p-4">
              <div class="profile-avatar-section text-center mb-4">
                <div class="profile-avatar rounded-circle mx-auto mb-3 d-flex align-items-center justify-content-center">
                  <i class="fas fa-user fa-3x text-gold"></i>
                </div>
                <h4 class="card-title fw-bold text-primary-custom mb-2"><%= @user.name %></h4>
              </div>

              <div class="profile-info">
                <% if @user.profile.present? %>
                  <div class="profile-description mb-4">
                    <h6 class="text-muted mb-2"><i class="fas fa-edit me-2"></i>プロフィール</h6>
                    <p class="card-text text-dark"><%= simple_format(@user.profile) %></p>
                  </div>
                <% end %>

                <div class="profile-stats mb-4">
                  <div class="row text-center">
                    <div class="col-6"><div class="stat-item"><h5 class="fw-bold text-gold mb-1"><%= @posts.count %></h5><small class="text-muted">投稿数</small></div></div>
                    <div class="col-6"><div class="stat-item"><h5 class="fw-bold text-gold mb-1"><%= @user.created_at.strftime("%Y年") %></h5><small class="text-muted">参加年</small></div></div>
                  </div>
                </div>

                <%# --- ↓↓↓ここが重要↓↓↓ --- %>
                <%# ログイン中 かつ 表示中のページが自分のページの場合のみ編集ボタンを表示 %>
                <% if user_signed_in? && current_user == @user %>
                  <% unless @user.guest_user? %>
                    <%= link_to edit_mypage_path, class: "btn btn-gold w-100 py-2" do %>
                      <i class="fas fa-edit me-2"></i>プロフィールを編集する
                    <% end %>
                  <% end %>
                <% end %>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="col-md-8">
        <div class="mypage-posts-section">
          <div class="d-flex justify-content-between align-items-center mb-4">
            <h3 class="font-serif fw-bold text-primary-custom display-6">
              <i class="fas fa-pen-alt me-2 text-gold"></i>投稿一覧
            </h3>

            <!--  
            <%# ログイン中 かつ 表示中のページが自分のページの場合のみ「新しい投稿」ボタンを表示 %>
            <% if user_signed_in? && current_user == @user %>
              <%= link_to new_post_path, class: "btn btn-gold" do %>
                <i class="fas fa-plus me-2"></i>新しい投稿
              <% end %>            
            <% end %>
            -->
            
          </div>

          <% if @posts.any? %>
            <div class="posts-grid">
              <% @posts.each do |post| %>
                <div class="post-item-card card border-0 shadow mb-4">
                  <div class="card-body p-4">
                    <h5 class="card-title fw-bold"><%= link_to post.title, post_path(post), class: "text-decoration-none text-primary-custom post-title-link" %></h5>
                    <div class="post-meta small text-muted mb-3"><i class="fas fa-calendar-alt me-1"></i><%= l post.created_at, format: :long %></div>
                    <p class="card-text text-dark mb-3"><%= truncate(post.body, length: 150) %></p>

                    <div class="post-actions d-flex justify-content-between align-items-center">
                      <div class="post-stats small text-muted">...</div>
                      
                      <%# --- ↓↓↓ここが重要↓↓↓ --- %>
                      <%# ログイン中 かつ 表示中のページが自分のページの場合のみ投稿の編集・削除ボタンを表示 %>
                      <% if user_signed_in? && current_user == @user %>
                        <div class="action-buttons">
                          <%= link_to edit_post_path(post), class: "btn btn-outline-primary btn-sm me-2" do %>
                            <i class="fas fa-edit me-1"></i>編集
                          <% end %>
                          <%= link_to post_path(post), method: :delete, data: { "turbo-method": :delete, "turbo-confirm": "本当に削除しますか？" }, class: "btn btn-outline-danger btn-sm" do %>
                            <i class="fas fa-trash me-1"></i>削除
                          <% end %>
                        </div>
                      <% end %>
                    </div>
                  </div>
                </div>
              <% end %>
            </div>
          <% else %>
            <div class="empty-state text-center py-5">
              <h4 class="text-muted mb-3">まだ投稿がありません</h4>
            </div>
          <% end %>
        </div>
      </div>

    </div>
  </div>
</div>