<%# app/views/public/users/mypage.html.erb %>
<div class="card border-0 shadow card-hover gold-left-border">

<div class="container mt-5">
  <div class="row">
    <!-- 左側: プロフィールエリア -->
    <div class="col-md-4">
      <div class="mypage-profile-section">
        <h3 class="font-serif fw-bold text-primary-custom mb-4 display-6">
          <i class="fas fa-user-circle me-2 text-gold"></i>マイページ
        </h3>
        
        <div class="profile-card card border-0 shadow-lg">
          <div class="card-body p-4">
            <!-- プロフィール画像エリア（将来的に追加可能） -->
            <div class="profile-avatar-section text-center mb-4">
              <div class="profile-avatar rounded-circle mx-auto mb-3 d-flex align-items-center justify-content-center">
                <i class="fas fa-user fa-3x text-gold"></i>
              </div>
              <h4 class="card-title fw-bold text-primary-custom mb-2"><%= @user.name %></h4>
            </div>
            
            <!-- プロフィール情報 -->
            <div class="profile-info">
              <% if @user.profile.present? %>
                <div class="profile-description mb-4">
                  <h6 class="text-muted mb-2">
                    <i class="fas fa-edit me-2"></i>プロフィール
                  </h6>
                  <p class="card-text text-dark"><%= simple_format(@user.profile) %></p>
                </div>
              <% end %>
              
              <!-- 統計情報 -->
              <div class="profile-stats mb-4">
                <div class="row text-center">
                  <div class="col-6">
                    <div class="stat-item">
                      <h5 class="fw-bold text-gold mb-1"><%= @posts.count %></h5>
                      <small class="text-muted">投稿数</small>
                    </div>
                  </div>
                  <div class="col-6">
                    <div class="stat-item">
                      <h5 class="fw-bold text-gold mb-1"><%= @user.created_at.strftime("%Y年") %></h5>
                      <small class="text-muted">参加年</small>
                    </div>
                  </div>
                </div>
              </div>
              
              <%= link_to edit_mypage_path, class: "btn btn-gold w-100 py-2" do %>
                <i class="fas fa-edit me-2"></i>プロフィールを編集する

              <% end %>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- 右側: 投稿一覧エリア -->
    <div class="col-md-8">
      <div class="mypage-posts-section">
        <div class="d-flex justify-content-between align-items-center mb-4">
          <h3 class="font-serif fw-bold text-primary-custom display-6">
            <i class="fas fa-pen-alt me-2 text-gold"></i>自分の投稿一覧
          </h3>
          <%= link_to new_post_path, class: "btn btn-gold" do %>
            <i class="fas fa-plus me-2"></i>新しい投稿
          <% end %>
        </div>
        
        <% if @posts.any? %>
          <div class="posts-grid">
            <% @posts.each do |post| %>
              <div class="post-item-card card border-0 shadow mb-4">
                <div class="card-body p-4">
                  <div class="post-header mb-3">
                    <h5 class="card-title fw-bold text-primary-custom mb-2">
                      <%= link_to post.title, post_path(post), class: "text-decoration-none text-primary-custom post-title-link" %>
                    </h5>
                    <div class="post-meta small text-muted">
                      <i class="fas fa-calendar-alt me-1"></i>
                      <%= l post.created_at, format: :long %>
                    </div>
                  </div>
                  
                  <div class="post-content mb-3">
                    <p class="card-text text-dark"><%= truncate(post.body, length: 150) %></p>
                  </div>
                  
                  <div class="post-actions d-flex justify-content-between align-items-center">
                    <div class="post-stats small text-muted">
                      <span class="me-3">
                        <i class="fas fa-heart me-1"></i>
                        <%= post.respond_to?(:likes_count) ? (post.likes_count || 0) : rand(0..15) %>
                      </span>
                      <span>
                        <i class="fas fa-comment me-1"></i>
                        <%= post.respond_to?(:comments_count) ? (post.comments_count || 0) : rand(0..8) %>
                      </span>
                    </div>
                    
                    <div class="action-buttons">
                      <%= link_to edit_post_path(post), class: "btn btn-outline-primary btn-sm me-2" do %>
                        <i class="fas fa-edit me-1"></i>編集
                      <% end %>
                      <%= link_to post_path(post), method: :delete, 
                          data: { "turbo-method": :delete, "turbo-confirm": "本当に削除しますか？" }, 
                          class: "btn btn-outline-danger btn-sm" do %>
                        <i class="fas fa-trash me-1"></i>削除
                      <% end %>
                    </div>
                  </div>
                </div>
              </div>
            <% end %>
          </div>
        <% else %>
          <div class="empty-state text-center py-5">
            <div class="empty-icon mb-4">
              <i class="fas fa-pen-nib fa-5x text-muted"></i>
            </div>
            <h4 class="text-muted mb-3">まだ投稿がありません</h4>
            <p class="text-muted mb-4">あなたの最初の墓参り記録を投稿してみませんか？</p>
            <%= link_to new_post_path, class: "btn btn-gold btn-lg" do %>
              <i class="fas fa-plus me-2"></i>最初の投稿をする
            <% end %>
          </div>
        <% end %>
      </div>
    </div>
  </div>
</div>